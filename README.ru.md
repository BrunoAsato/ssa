# SmallServerAdmin (SSA)

Веб-панель управления для небольших серверов **Debian**.

Панель написана на **PHP**, взаимодействие с сервером осуществляется по **SSH**.

Панель имеет модульную структуру и позволяет легко добавлять новые и улучшать уже имеющиеся модули.

## Особенности

* Управление пользователями:
  * просмотр, создание, редактирование и удаление пользователей.
* Управление сайтами:
  * схема работы Nginx + Apache;
  * просмотр списка сайтов;
  * редактор файлов конфигурации сайтов;
  * включение и отключение сайтов;
  * создание файлов конфигурации из динамичных шаблонов;
  * удаление сайтов.
* Управление файлами:
  * просмотр списка файлов и папок;
  * создание новых папок и текстовых файлов;
  * просмотр и редактирование текстовых файлов;
  * удаление файлов и папок;
  * управление разрешениями.
* Управление сервером SVN:
  * просмотр и редактирование списка пользователей и групп;
  * создание и удаление репозиториев.
* Мониторинг: 
  * просмотр списка процессов;
  * удаление процессов;
  * индикаторы использования ЦП, ОЗУ и жестких дисков.
* Управление службами: запуск, остановка и перезагрузка служб;
* Клиент SSH: одностороннее исполнение простых команд.

## Лицензия

Исходный код **SmallServerAdmin** предоставляется на условиях лицензии **Apache License Version 2.0**.

См. также [условия использования используемых компонентов](THIRDPARTYNOTICE.md).

## Системные требования

Требования к управляемому серверу:

* Debian 7 или 8;
* OpenSSH >= 6.7;
* sudo >= 1.8.10;
* sysstat >= 11.0.1;
* Nginx >= 1.9 + Apache >= 2.4;
* [htan-runner](https://github.com/adminstock/htan-runner) для ASP.NET FastCGI;
* См. также файлы README конкретных модулей.

Сама панель управления (**SmallServerAdmin**) может быть размещена на любом другом сервере.

Требования к серверу для размещения панели управления:

* Linux, Windows, Mac OS/OS X;
* Apache и/или Nginx, или IIS, или другой веб-сервер с поддержкой PHP;
* PHP 5 >= 5.5 с модулем php_ssh2.dll;

_**Примечание:** Работа с младшими версиями не проверялась, но в теории возможна._

_**Примечание:** Для Windows требуется PHP v5.5, с более старшими версиями могут быть проблемы._

## Установка и настройка

### Настройка управляемого сервера

Если **SmallServerAdmin** будет располагаться на управляемом сервере, то для её установки и настройки рекомендуется использовать 
**[HTAN](https://github.com/adminstock/htan)**:

```bash
# требуются права root
su -l root

# обновляем сервер
apt-get update && apt-get upgrade

# устанавливаем необходимые компоненты
apt-get install -y less libpcre3 subversion

# получаем htan
svn export https://github.com/adminstock/htan.git/trunk/ /usr/lib/htan

# устанавливаем SmallServerAdmin
chmod u=rx,g=rx /usr/lib/htan/installers/ssa
/usr/lib/htan/installers/ssa --lang=ru
```

Пользуемся! :)

#### Установка вручную

Если автоматическая установка для вас не подходит или не работает, панель можно установить вручную.

Установите пакеты **openssh-server**, **sudo** и **sysstat**:

```Shell
su -l root -c 'apt-get -y install openssh-server sudo sysstat'
```

Также рекомендуется установить **etckeeper**:

```Shell
su -l root -c 'apt-get -y install etckeeper'
su -l root -c '[[ ! -d "/etc/.git" ]] && cd /etc && etckeeper init'
```

Для безопасности лучшим решением будет создание отдельного пользователя, от имени которого панель будет работать с сервером.

Например, создадим для **SmallServerAdmin** пользователя с именем **ssa**:

```Shell
sudo adduser ssa --shell /bin/bash --no-create-home --gecos 'SmallServerAdmin'
```

_**Примечание:** Вы можете использовать любое другое имя._

_**Предупреждение:** Запишите пароль, он понадобится для настройки панели._

Затем необходимо добавить пользователя в группу **sudo**:

```Shell
sudo usermod -a -G sudo ssa
```

И перезапустить **sudo**:

```Shell
sudo service sudo restart
```

Если в настройках сервера **SSH** ограничен список пользователей, которым разрешено подключение к серверу, 
то необходимо добавить разрешение для созданного пользователя.

Отктройте файл `/etc/ssh/sshd_config`:

```Shell
sudo nano /etc/ssh/sshd_config
```

Найдите параметр `AllowUsers` и добавьте туда созданного пользователя:

```Shell
AllowUsers ssa
```

Если параметра `AllowUsers` нет, то ничего делать не нужно.

_**Примечание:** Список пользователей разделяется пробелами. Например: `user1 user2 ssa userN`._

### Настройка SmallServerAdmin

Настройки панели располагаются в файле **ssa.config.php** в переменной `$config`.

Панель имеет модульную структуру и каждый модуль может иметь собственный набор параметров.

Информацию о параметрах модулей можно найти в файлах README конкретных модулей.

#### SSH

_**Примечание:** Если вы использовали **[HTAN](https://github.com/adminstock/htan)** для установки **SmallServerAdmin**, то менять параметры **SSH** не требуется._

Для правильной работы панели, необходимо настроить параметры соединения по **SSH**.

```PHP
// адрес ssh-сеовеоа (управляемого сервера)
$config['ssh_host'] = '192.168.56.139';
// ssh-порт (по умолчанию: 22)
$config['ssh_port'] = '22';
// имя пользователя (например: ssa)
$config['ssh_user'] = 'username';
// пароль пользователя
$config['ssh_password'] = 'password';
// требуется ввод пароля для пользователя sudo или нет
$config['ssh_required_password'] = TRUE;
```

Если панель испытывает трудности с подключением к серверу, то следует проверить правильность настройки сервера.

Все команды выполняются через **sudo**. 
Если значение параметра `ssh_required_password` равняется `TRUE`, 
то для каждой команды будет вводится пароль (`ssh_password`).

Если на сервере нет других пользователей, то можно отключить постоянный ввод пароля.
Тогда значение параметра `ssh_required_password` может равняться `FALSE`.
Помимо этого, необходимо настроить **sudo**, чтобы он не требовал ввод пароля для пользователя:

```Shell
sudo bash -c 'echo "ssa ALL=(ALL) NOPASSWD:ALL" | (EDITOR="tee -a" visudo)'
```

_**Примечание:** В любом случае, для подключения к серверу будет использоваться пароль._

_**Предупреждение:** Если на сервере много пользователей или сервер используется в качестве публичного хостинга, 
в целях безопасности не рекомендуется отключать требование ввода пароля._

#### Модули

В параметре `modules` можно указать список необходимых модулей, через запятую. 
Указанный модули будут выводиться в меню навигации.

```PHP
$config['modules'] = 'users,svn,sites,files,monitoring,services,ssh';
```

#### Виджеты

Некоторые модули могут иметь виджеты, который могут выводиться на главной странице панели.

Параметры виджетов находятся в корневом элементе - `widgets`, 
где дочерним элементом является имя модуля, к которому принадлежит виджет: 
`$config['widgets']['имяМодуля']`.

В настройках каждого виджета обязательно должен присутствовать параметр `Enabled`,
который указывает допустимость вывода виджета на главной странице.

Дополнительно может быть указан параметр `Format`, который определяет формат вывода виджета.

Помимо этого, каждый виджет может иметь собственный набор любых других настроек,
информацию о которых можно найти в файле README конкретного модуля.

```PHP
$config['widgets']['monitoring'] = ['Enabled' => TRUE];
$config['widgets']['services'] = [
  'Enabled' => TRUE, 
  'Format' => '<div>%s</div>', 
  'NgInit' => 'SearchString = \'nginx,apache\'; Load()' 
];
$config['widgets']['sites'] = [
  'Enabled' => TRUE, 
  'Format' => '<div>%s</div>'
];
```

## Смотрите также

* [История изменений](CHANGELOG.md)
* [Участие в проекте SmallServerAdmin](CONTRIBUTING.md)
* [Инструменты для хостинга (HTAN)](https://github.com/adminstock/htan)